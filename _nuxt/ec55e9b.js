(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{342:function(t,e,o){var content=o(495);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,o(76).default)("1b7833da",content,!0,{sourceMap:!1})},493:function(t){t.exports=JSON.parse('{"backgroundColor":"#160804","cornerFill":"#ffd70040","cornerStroke":"#ffd700ff","fontFamily":"\'IM Fell English SC\'","fontFamilyFallback":"serif","globalAlpha":0.25,"imageFilter":"brightness(120%)","imageSrc":"/jpegs/Mozart-Lange-darker.jpg","matchBoundaryFill":"#160804","matchFill":"#89001e","mode":2,"shadowColor":"#572010ff","shadowOffsetX":0.5,"textSizeDefault":20,"word":"MOZART","ersatzAsArray":null,"wordAsArray":null,"factorial":null,"tweaks":{"x":0,"y":0,"cx":0,"cy":0,"textSizeAdjustment":0},"style":{"canvas":{"objectPositionX":"50%","objectPositionY":"50%","scaleTransform":"100%"}}}')},494:function(t,e,o){"use strict";o(342)},495:function(t,e,o){var n=o(75)(!1);n.push([t.i,"main{position:relative}.animate{-webkit-animation:fadeOut 3s forwards;animation:fadeOut 3s forwards}@-webkit-keyframes fadeOut{0%{filter:blur(20px);opacity:1}to{filter:blur(0);opacity:0}}@keyframes fadeOut{0%{filter:blur(20px);opacity:1}to{filter:blur(0);opacity:0}}.invisible{opacity:0}.cover{display:block;position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}",""]),t.exports=n},508:function(t,e,o){"use strict";o.r(e);o(38),o(28),o(50),o(29),o(51);var n=o(22),r=o(95),c=o(7),h=(o(36),o(9),o(345),o(15),o(349),o(351),o(353),o(354),o(355),o(356),o(357),o(358),o(359),o(360),o(361),o(362),o(363),o(364),o(365),o(366),o(20),o(109),o(62),o(47),o(139),o(298),o(74),o(78),o(205),o(105),o(367),o(368),o(37),o(60),o(44),o(34),o(369)),l=o(0),f=o(492),d=o.n(f);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(object);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,o)}return e}function m(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(n.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}l.a.use(d.a,{disableClick:!1});var w={data:function(){return{box:{cols:void 0,rows:void 0},canvas:undefined,cheat:"",doToast:!0,hiddenPermutations:new Set,ignoreNextTap:!1,matches:{horz:[],vert:[]},modes:["coloredLettersTransparentBackground","adaptiveLettersColoredBackground"],palette:undefined,shuffle:undefined,slideshowAverageTimeBetweenSlides:{slides:1,total:1500},slideshowID:undefined,toastOptions:{duration:1200,position:"top-center",theme:"outline"}}},computed:{config:function(){return o(493)},slideshow:{get:function(){return this.slideshowID},set:function(t){this.slideshowID=t}},timeBetweenSlides:{get:function(){return Math.round(this.slideshowAverageTimeBetweenSlides.total/this.slideshowAverageTimeBetweenSlides.slides)},set:function(t){this.slideshowAverageTimeBetweenSlides.slides++,this.slideshowAverageTimeBetweenSlides.total+=t}},cheating:{get:function(){return"cheat"===this.cheat},set:function(t){var e="cheat"===this.cheat,o=e;if("boolean"==typeof t)o=t;else if("string"==typeof t&&t.length&&!e){var n=this.cheat+t;"cheat"===n?o=!0:"cheat".startsWith(n)?this.cheat=n:o=!1}e!==o&&(o?(this.cheat="cheat",this.doToast&&this.$toast.show("Now cheating",this.toastOptions)):(this.cheat="",this.doToast&&this.$toast.show("Stopped cheating",this.toastOptions)),this.createOrRedrawCanvas())}},style:function(){return"\nimg, canvas {\n  object-position: ".concat(this.config.style.canvas.objectPositionX," ").concat(this.config.style.canvas.objectPositionY,";\n  transform: scale(").concat(this.config.style.canvas.scaleTransform,");\n}")}},destroyed:function(){this.contextmenuEventListener&&window.removeEventListener("contextmenu",this.contextmenuEventListener),this.keyupEventListener&&window.removeEventListener("keyup",this.keyupEventListener)},mounted:function(){var t=this;this.config.wordAsArray=this.config.wordAsArray||this.config.word.split(""),this.config.ersatzAsArray=this.config.ersatzAsArray||Array(this.config.word.length).fill("âˆ…"),this.config.factorial=this.factorialize(this.config.wordAsArray.length),1===this.config.mode&&h.from(document.getElementById("portrait-image")).getPalette().then((function(e){t.palette=e})),this.init(),this.contextmenuEventListener&&window.removeEventListener("contextmenu",this.contextmenuEventListener),this.contextmenuEventListener=window.addEventListener("contextmenu",(function(t){t.preventDefault()})),this.keyupEventListener&&window.removeEventListener("keyup",this.keyupEventListener),this.keyupEventListener=window.addEventListener("keyup",(function(e){if("Enter"===e.code)t.startOrStopOrToggleSlideshow(!0),e.preventDefault();else if("Space"===e.code){var o=void 0!==t.slideshow;t.startOrStopOrToggleSlideshow(!1),o||t.animateShuffleAndRedraw(),e.preventDefault()}else"Escape"===e.code?(t.cheating=!1,e.preventDefault()):"cheat".includes(e.key)&&(t.cheating=e.key,e.preventDefault())}))},methods:{init:function(){this.shuffle=this.doShuffle(this.config.factorial);for(var i=0;i<this.config.factorial;i++){var t=this.pickPermutation(this.config.wordAsArray,this.config.factorial,i);(function(t,e){return t.length===e.length&&t.every((function(t,i){return t===e[i]}))})(t,this.config.wordAsArray)&&(this.hiddenPermutations.add(i),console.log("REMEMBER nth permutation",i,t,this.hiddenPermutations))}var e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return new Promise((function(n,r){var h=setInterval(Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,document.fonts.load(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),r(e.t0);case 8:document.fonts.check(t)&&(clearInterval(h),console.log("font loaded"),n(!0));case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),o);setTimeout((function(){return clearInterval(h)}),e)}))}(this.fontFamily(),2e3,100),o=new Promise((function(t,e){document.getElementById("portrait-image").addEventListener("load",(function(e){console.log("image loaded"),t(this)}),{once:!0})})),n=this;Promise.all([e,o]).then((function(data){n.createOrRedrawCanvas(data[1]);var t=document.getElementById("portrait-image-canvas").classList;t.add("cover"),t.remove("invisible");var e=document.getElementById("portrait-image").classList;e.add("cover"),e.remove("invisible"),e.add("animate")}))},fontFamily:function(t){return t||(t=20),"bold ".concat(t,"px ").concat(this.config.fontFamily,", ").concat(this.config.fontFamilyFallback)},animateShuffleAndRedrawIfNoSlideshow:function(){void 0===this.slideshow&&this.animateShuffleAndRedraw()},toggleCheating:function(t){this.ignoreNextTap=!0,this.cheating=!this.cheating,t.preventDefault(),t.stopPropagation()},doShuffle:function(t){return function(t){for(var e,i,o=t.length;o;)i=Math.floor(Math.random()*o--),e=t[o],t[o]=t[i],t[i]=e;return t}(Object(r.a)(Array(t).keys()))},animateShuffleAndRedraw:function(t){var e=this;if(this.ignoreNextTap)this.ignoreNextTap=!1;else{var o=document.getElementById("portrait-image");o.classList.remove("animate"),o.offsetWidth,o.classList.add("animate"),this.$nextTick((function(){e.shuffleAndRedraw(t)}))}},shuffleAndRedraw:function(t){t=t||1;var e,o=0;do{e=this.doShuffle(this.config.factorial),o=this.storeMatches(e)}while(o<t);this.shuffle=e,this.cheating||this.doToast&&this.$toast.show("".concat(this.matches.horz.length," horizontal, ").concat(this.matches.vert.length," vertical"),m(m({},this.toastOptions),{duration:Math.max(1500,this.timeBetweenSlides-500)})),this.createOrRedrawCanvas()},startOrStopOrToggleSlideshow:function(t){if(void 0===t&&(t=void 0===this.slideshow),t&&void 0===this.slideshow){this.doToast&&this.$toast.show("Starting slideshow",this.toastOptions),this.shuffleAndRedraw();var e=new Date;this.slideshow=setInterval(function(){if(void 0!==this.slideshow){this.shuffleAndRedraw();var t=e;e=new Date,this.timeBetweenSlides=Math.abs(e.getTime()-t.getTime())}}.bind(this),2e3)}else t||void 0===this.slideshow||(clearInterval(this.slideshow),this.slideshow=void 0,this.doToast&&this.$toast.show("Slideshow stopped",this.toastOptions))},createOrRedrawCanvas:function(img){var t={cornerFillStyle:this.cornerFill,cornerStrokeStyle:this.cornerStroke,filter:this.config.imageFilter,resolution:this.calcResolution,shape:this.drawLetter,wordAsArray:this.config.wordAsArray,windowWidth:document.getElementById("main").clientWidth,windowHeight:document.getElementById("main").clientHeight};return img?this.canvas=img.closePixelate(t):this.canvas.renderClosePixels(t),this.canvas},pickShuffledPermutation:function(t,e,o,n){var c=o[n=Math.floor(n)];return this.hiddenPermutations.has(c)?Object(r.a)(this.config.ersatzAsArray):this.pickPermutation(t,e,c)},pickPermutation:function(t,e,o){if(e<o)return console.log("n (".concat(o,") cannot be larger than factorial (").concat(e,") !!!")),[];for(var n,q,c,h=o,l=Object(r.a)(t),f=[],d=e;l.length>0;)q=(h-(n=h%(d/=l.length)))/d,c=l.splice(q,1)[0],f.push(c),h=n;return f},horizontal:function(t){for(var e=[],o={boundary:void 0,accumulator:[]},n=0;n<this.box.rows;n++)for(var col=0;col<this.box.cols;col++){var i=col+n*this.box.cols,r=i/this.config.wordAsArray.length,c=i%this.config.wordAsArray.length;0===e.length&&(e=this.pickShuffledPermutation(this.config.wordAsArray,this.config.factorial,t,r));var h=e.shift();0===c&&(o.boundary=i-o.accumulator.length);var l=this.testIfMatch(this.config.wordAsArray,o,h);l&&this.matches.horz.push(l)}},vertical:function(t){for(var e={boundary:void 0,accumulator:[]},col=0;col<this.box.cols;col++)for(var o=0;o<this.box.rows;o++){var i=col+o*this.box.cols,n=i/this.config.wordAsArray.length,r=i%this.config.wordAsArray.length,c=this.pickShuffledPermutation(this.config.wordAsArray,this.config.factorial,t,n)[r];e.boundary?e.boundary.push(i):e.boundary=[i];var h=this.testIfMatch(this.config.wordAsArray,e,c);h&&this.matches.vert.push(h)}},storeMatches:function(t){return this.matches.horz.splice(0,this.matches.horz.length),this.matches.vert.splice(0,this.matches.vert.length),this.vertical(t),this.horizontal(t),this.matches.vert.length+this.matches.horz.length},printCandidate:function(t,e){for(var o=[],i=0;i<t.length;i++)i===e%t.length&&o.push("|"),o.push(t[i]);return o.join("")},resetCandidate:function(t){t.accumulator.splice(0,t.accumulator.length),t.boundary=void 0},testIfMatch:function(t,e,o){var n;e.accumulator.push(o);for(var i=0;i<e.accumulator.length;i++)if(e.accumulator[i]!==t[i]){this.resetCandidate(e);break}return i===t.length&&(n=e.boundary,this.resetCandidate(e)),n},getTextRatio:function(t){t.save(),t.font=this.fontFamily();var e=t.measureText(this.config.word),o=e.width/(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);return t.restore(),o},getFontSizeToFit:function(t,e,o){t.save();t.font=this.fontFamily(20);var n=t.measureText(this.config.word),r=n.width/this.config.word.length,c=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;t.restore();var h=Math.min(e+this.config.tweaks.textSizeAdjustment/r*20,o+this.config.tweaks.textSizeAdjustment/c*20);return t.font=this.fontFamily(h),h},tweakAndFillRect:function(t,e,o,n,r){t.fillRect(e+this.config.tweaks.x,o+this.config.tweaks.y,n+this.config.tweaks.cx,r+this.config.tweaks.cy)},tweakAndStrokeRect:function(t,e,o,n,r){t.strokeRect(e+this.config.tweaks.x,o+this.config.tweaks.y,n+this.config.tweaks.cx,r+this.config.tweaks.cy)},drawLetter:function(t,e,i,o,n,r,c,l){if(!(i>this.box.cols*this.box.rows)){var f=l;void 0!==f&&0!==f.length||(f=this.pickShuffledPermutation(this.config.wordAsArray,this.config.factorial,this.shuffle,i/e.length));var d,v=f.shift();if(t.textAlign="center",t.textBaseline="middle",t.shadowColor=this.config.shadowColor,t.shadowOffsetX=this.config.shadowOffsetX,1===this.config.mode){var m=Number.MAX_SAFE_INTEGER;for(var w in d=t.fillStyle,this.palette){var y=h.Util.hexDiff(this.palette[w].getHex(),t.fillStyle);y<m&&(m=y,d=this.palette[w].getBodyTextColor())}}if(1===this.config.mode?t.fillRect(o,n,r,c):2===this.config.mode&&(t.save(),t.globalAlpha=this.config.globalAlpha,t.fillRect(o,n,r,c),t.restore()),this.cheating){if(this.matches.horz.length)for(var b=0;b<this.matches.horz.length;b++){var A=this.matches.horz[b];A<=i&&i<A+this.config.wordAsArray.length&&(t.save(),t.filter="blur(3px)",t.fillStyle=this.config.matchFill,this.tweakAndFillRect(t,o,n,r,c),t.restore(),i%e.length==0&&this.config.matchBoundaryFill&&(t.save(),t.fillStyle=this.config.matchBoundaryFill,this.tweakAndFillRect(t,o,n,1,c),t.restore()))}if(this.matches.vert.length)for(var x=0;x<this.matches.vert.length;x++){this.matches.vert[x].includes(i)&&(t.save(),t.filter="blur(3px)",t.fillStyle=this.config.matchFill,this.tweakAndFillRect(t,o,n,r,c),t.restore())}}return d&&(t.fillStyle=d),t.fillText(v,o+r/2,n+c/2+2),f}},calcResolution:function(t,e,o){var n=this.config.factorial,r=this.getDivisorsList(n).map((function(t){return{x:t,y:n/t,ratio:t/(n/t)}})),c=e/o/this.getTextRatio(t),h=this.binarySearch(r.map((function(t){return t.ratio})),c),l=r[h].x*this.config.word.length,f=r[h].y,d=e/l,v=o/f;return this.box={cols:l,rows:f,cxCol:d,cyRow:v,factorial:n},this.textSizeDefault=this.getFontSizeToFit(t,d,v),this.box},factorialize:function(t){if(void 0!==t)return t<0?-1:0===t?1:t*this.factorialize(t-1)},getDivisorsList:function(t){var e,o=[];return e=t,Object(r.a)(Array(e+1).keys()).slice(1).reduce((function(s,a){var t=!(e%a)&&a;return t&&o.push(t),s+t}),0),o},binarySearch:function(t,e){if(1===t.length)return 0;var o=Math.floor(t.length/2);return t[o]===e?o:t[o]>e?this.binarySearch(t.slice(0,o),e):t[o]<e?o+this.binarySearch(t.slice(o),e):o}}},y=w,A=(o(494),o(54)),component=Object(A.a)(y,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("main",{staticClass:"vh-100",style:"background-color: "+t.config.backgroundColor,attrs:{id:"main"}},[o("style",{tag:"component"},[t._v("\n    "+t._s(t.style)+"\n  ")]),t._v(" "),o("div",{style:"font-family: "+t.fontFamily()+"; visibility: hidden;"},[t._v("force browser to load font")]),t._v(" "),o("img",{directives:[{name:"touch",rawName:"v-touch:tap",value:t.animateShuffleAndRedrawIfNoSlideshow,expression:"animateShuffleAndRedrawIfNoSlideshow",arg:"tap"},{name:"touch",rawName:"v-touch:touchhold",value:t.toggleCheating,expression:"toggleCheating",arg:"touchhold"}],staticClass:"invisible",attrs:{id:"portrait-image",src:t.config.imageSrc}})],1)}),[],!1,null,null,null);e.default=component.exports}}]);